!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.App=t()}}(function(){return function t(e,i,s){function o(a,r){if(!i[a]){if(!e[a]){var p="function"==typeof require&&require;if(!r&&p)return p(a,!0);if(n)return n(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var l=i[a]={exports:{}};e[a][0].call(l.exports,function(t){var i=e[a][1][t];return o(i?i:t)},l,l.exports,t,e,i,s)}return i[a].exports}for(var n="function"==typeof require&&require,a=0;a<s.length;a++)o(s[a]);return o}({"/private/var/www/vhosts/pgm-multiloc/src/scripts/app/app.ts":[function(t,e,i){"use strict";var s=t("jquery");t("jquery-migrate"),t("foundation-sites");var o=t("lodash"),n=t("./gmaps.ts"),a=function(){function t(t,e){this.latLng=new google.maps.LatLng(t,e)}return t.prototype.toString=function(){return this.latLng.lat()+", "+this.latLng.lng()},t.prototype.getLatLng=function(){return this.latLng},t}();i.Location=a;var r=function(){function t(){}return t.getHiveRadius=function(t){return(t-1)*Math.sqrt(3)*this.scanRadius+this.scanRadius},t.getStepsToCoverRadius=function(t){return Math.ceil((t-this.scanRadius)/this.scanRadius/Math.sqrt(3)+1)},t.getBeehiveRadius=function(e,i){return Math.floor(3*(e-1)/2-.5)*(t.getHiveRadius(i)-t.hiveOverlap)+t.getHiveRadius(i)},t.getLeapsToCoverRadius=function(e,i){return Math.ceil(2*((e-t.getHiveRadius(i))/(t.getHiveRadius(i)-t.hiveOverlap)+.5)/3+1)},t.distanceBetweenHiveCenters=function(e){var i=(e-1)*(3*this.scanRadius/2)+t.locationAdjustment;return 2*i-t.hiveOverlap},t.scanRadius=70,t.locationAdjustment=Math.sqrt(3)*t.scanRadius/2,t.hiveOverlap=t.scanRadius/2-2*(t.scanRadius-t.locationAdjustment),t}();i.Util=r;var p=function(){function t(){new n.GMaps;s(document).foundation(),Foundation.Abide.defaults.validators.accountColumns=function(t,e,i){var n=s("#accounts").val();if(!e)return!0;if(e&&o.isEmpty(n))return!1;var a=Number(s("#accountColumns").val().split(",").length),r=n.split("\n"),p=o.some(r,function(t){var e=t.split(",").length;return a!==e});return!p},Foundation.Abide.defaults.validators.enoughAccounts=function(t,e,i){var n=Number(s("#workers").val())*Number(s("#hives").val()),a=s("#accounts").val();if(o.isEmpty(a))return!1;var r=a.split("\n").length;return r>=n}}return t}();i.App=p},{"./gmaps.ts":"/private/var/www/vhosts/pgm-multiloc/src/scripts/app/gmaps.ts","foundation-sites":"foundation-sites",jquery:"jquery","jquery-migrate":"jquery-migrate",lodash:"lodash"}],"/private/var/www/vhosts/pgm-multiloc/src/scripts/app/beehive.ts":[function(t,e,i){"use strict";var s=t("./app.ts"),o=t("./hive.ts"),n=t("knockout"),a=t("lodash"),r=function(){function t(t){var e=this;this.options=t,this.hives=n.observableArray([]),this.isEditingHives=!1,this.coveringRadius=s.Util.getBeehiveRadius(this.options.leaps,this.options.steps),this.activeHives=n.computed(function(){return e.getActiveHives()},this,{deferEvaluation:!0}),this.mapObject=new google.maps.Circle({radius:this.coveringRadius,fillColor:"#0000FF",fillOpacity:0,strokeWeight:1,clickable:!0,center:this.options.center.getLatLng(),editable:!0,draggable:!0,zIndex:3}),this.options.map.addMapObject(this.mapObject),this.generateHives(),this.toggleActive(),this.options.map.addListener(this.mapObject,"click",function(){return e.toggleActive()}),this.options.map.addListener(this.mapObject,"radius_changed",function(){e.coveringRadius=e.mapObject.getRadius();var t=s.Util.getLeapsToCoverRadius(e.coveringRadius,e.options.steps);e.options.leaps!==t&&(e.options.leaps=t,e.generateHives())}),this.options.map.addListener(this.mapObject,"center_changed",function(){var t=e.mapObject.getCenter();e.options.center=new s.Location(t.lat(),t.lng()),e.generateHives()})}return t.prototype.getHives=function(){return console.log("getting hives for "+this.options.center.toString()),this.hives()},t.prototype.reset=function(t){void 0===t&&(t=!1);for(var e=0;e<this.hives().length;e++)this.hives()[e].reset();this.hives([]),t&&(this.mapObject=this.options.map.removeMapObject(this.mapObject))},t.prototype.generateHives=function(){var t=this;this.reset();var e=[],i=s.Util.distanceBetweenHiveCenters(this.options.steps),n=function(n,a,r,p){void 0===r&&(r=i),void 0===p&&(p=!0);var c=google.maps.geometry.spherical.computeOffset(n,r,a);return p&&(c=google.maps.geometry.spherical.computeOffset(c,s.Util.locationAdjustment,a+90)),e.push(new o.Hive({center:new s.Location(c.lat(),c.lng()),steps:t.options.steps,map:t.options.map})),c},a=this.options.center.getLatLng();a=n(a,0,0,!1),this.lastHiveCenter=a;for(var r=2;r<=this.options.leaps;r++){a=n(this.lastHiveCenter,0,i),this.lastHiveCenter=a;for(var p=1;p<r;p++)a=n(a,120);for(var c=1;c<r;c++)a=n(a,180);for(var l=1;l<r;l++)a=n(a,240);for(var u=1;u<r;u++)a=n(a,300);for(var v=1;v<r;v++)a=n(a,0);for(var h=2;h<r;h++)a=n(a,60)}return this.hives(e),this.hives()},t.prototype.resize=function(t){this.options.steps=t,this.options.leaps=s.Util.getLeapsToCoverRadius(this.coveringRadius,this.options.steps),this.generateHives()},t.prototype.disableActive=function(){this.isActive=!1,this.isEditingHives&&this.editHives(),this.mapObject.set("fillOpacity",0)},t.prototype.toggleActive=function(t){void 0===t&&(t=!1),this.isActive=!this.isActive,this.mapObject.set("fillOpacity",this.isActive?.3:0),this.options.map.setActiveBeehive(this.isActive?this:null)},t.prototype.editHives=function(){this.isEditingHives=!this.isEditingHives;for(var t=0;t<this.hives().length;t++)this.isEditingHives?this.hives()[t].addListener():this.hives()[t].removeListener();this.mapObject.set("zIndex",this.isEditingHives?1:3),this.mapObject.set("fillOpacity",this.isEditingHives?0:.3)},t.prototype.getActiveHives=function(){return a.filter(this.hives(),function(t){return t.isActive()})},t}();i.Beehive=r},{"./app.ts":"/private/var/www/vhosts/pgm-multiloc/src/scripts/app/app.ts","./hive.ts":"/private/var/www/vhosts/pgm-multiloc/src/scripts/app/hive.ts",knockout:"knockout",lodash:"lodash"}],"/private/var/www/vhosts/pgm-multiloc/src/scripts/app/gmaps.ts":[function(t,e,i){"use strict";var s=t("../config.ts"),o=t("load-google-maps-api"),n=t("./app.ts"),a=t("./map.ts"),r=function(){function t(){var t=this;this.map=new a.Map,o.default({key:s.config.googleMapsKey,libraries:["places","geometry"]}).then(function(e){t.initMap()})}return t.prototype.getMap=function(){return this.map},t.prototype.initMap=function(){var t=this;this.gmap=new google.maps.Map(document.getElementById("map"),{zoom:s.config.zoom,center:new google.maps.LatLng(s.config.latitude,s.config.longitude),mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.TOP_RIGHT}});var e=document.getElementById("pac-input");document.getElementById("latlng").placeholder="'"+s.config.latitude+","+s.config.longitude+"'",this.gmap.controls[google.maps.ControlPosition.TOP_LEFT].push(document.getElementById("custom-map-controls")),this.gmap.controls[google.maps.ControlPosition.BOTTOM_CENTER].push(document.getElementById("script-options"));var i=new google.maps.places.Autocomplete(e);i.bindTo("bounds",this.gmap),i.addListener("place_changed",function(){var e=i.getPlace();if(e.geometry){t.gmap.setCenter(e.geometry.location),t.gmap.setZoom(10);var s=document.getElementById("latlng");s.value=String(e.geometry.location.lat())+","+String(e.geometry.location.lng())}}),document.getElementById("submit").addEventListener("click",function(){t.geocoder=new google.maps.Geocoder;var e=document.getElementById("latlng");if(!e.value)return void window.alert("Please enter a valid location or coordinates to add a new hive.");var i=e.value.split(",",2),s={lat:parseFloat(i[0]),lng:parseFloat(i[1])};t.geocoder.geocode({location:s},function(e,o){var a=String(o);"OK"===a?e[1]?(t.gmap.setZoom(12),t.gmap.setCenter(s),t.map.addBeehive(new n.Location(parseFloat(i[0]),parseFloat(i[1])))):window.alert("No results found."):window.alert("Geocoder failed due to: "+o)})}),document.getElementById("legacy-checkbox").addEventListener("click",function(){var e=document.getElementById("legacy-label");e.classList.toggle("legacy-mode"),e.classList.contains("legacy-mode")?t.gmap.addListener("click",function(e){t.map.addBeehive(new n.Location(e.latLng.lat(),e.latLng.lng())),t.gmap.setCenter({lat:e.latLng.lat(),lng:e.latLng.lng()})}):google.maps.event.clearListeners(t.gmap,"click")}),google.maps.event.addListenerOnce(this.gmap,"idle",function(){t.map.initMap({gmap:t.gmap})})},t}();i.GMaps=r},{"../config.ts":"/private/var/www/vhosts/pgm-multiloc/src/scripts/config.ts","./app.ts":"/private/var/www/vhosts/pgm-multiloc/src/scripts/app/app.ts","./map.ts":"/private/var/www/vhosts/pgm-multiloc/src/scripts/app/map.ts","load-google-maps-api":"load-google-maps-api"}],"/private/var/www/vhosts/pgm-multiloc/src/scripts/app/hive.ts":[function(t,e,i){"use strict";var s=t("./app.ts"),o=t("knockout"),n=function(){function t(t){this.options=t,this.isActive=o.observable(!1);var e=this.options.center.getLatLng(),i=s.Util.getHiveRadius(this.options.steps),n=google.maps.geometry.spherical.computeOffset,a=[n(e,i,30),n(e,i,90),n(e,i,150),n(e,i,210),n(e,i,270),n(e,i,330)],r=new google.maps.Polygon({paths:a,fillOpacity:.3,strokeWeight:1,zIndex:2});this.mapObject=r,this.toggleActive(),this.options.map.addMapObject(r)}return Object.defineProperty(t.prototype,"steps",{get:function(){return this.options.steps},enumerable:!0,configurable:!0}),t.prototype.reset=function(){this.mapObject=this.options.map.removeMapObject(this.mapObject)},t.prototype.toggleActive=function(){this.isActive(!this.isActive()),this.mapObject.set("fillColor",this.isActive()?"#0F0":"#F00")},t.prototype.addListener=function(){var t=this;this.activeListener=google.maps.event.addListener(this.mapObject,"click",function(){return t.toggleActive()})},t.prototype.removeListener=function(){this.activeListener.remove()},t.prototype.getCenter=function(){return this.options.center},t}();i.Hive=n},{"./app.ts":"/private/var/www/vhosts/pgm-multiloc/src/scripts/app/app.ts",knockout:"knockout"}],"/private/var/www/vhosts/pgm-multiloc/src/scripts/app/map.ts":[function(t,e,i){"use strict";var s=t("../config.ts"),o=t("./beehive.ts"),n=t("jquery"),a=t("./viewModel.ts"),r=t("knockout"),p=t("lodash"),c=function(){function t(){var t=this;this.beehives=r.observableArray([]),this.activeBeehive=null,this.steps=s.config.steps,this.activeHives=r.computed(function(){return t.getActiveHives()})}return t.prototype.initMap=function(t){var e=this;this.options=t;var i=n("#beehive-control .slider").data("zfPlugin").options;i.end=s.config.maxSteps,i.initialStart=s.config.steps,n("#custom-map-controls").show(),Foundation.reInit(["slider"]),n("#beehive-control .slider").on("moved.zf.slider",function(t){return e.changeSteps(t)}),n("#remove").on("click",function(){return e.removeActiveHive()}),n("#edit-hives").on("click",function(){return e.editHives()}),n("#generate-ui-wrapper").on("open.zf.reveal",function(){p.forEach(n("input,select,textarea","#generate-ui"),function(t){return n("#generate-ui").foundation("validateInput",n(t))})});var o=new a.ViewModel({map:this});r.applyBindings(o,document.getElementsByTagName("body")[0])},t.prototype.addBeehive=function(t){var e=new o.Beehive({map:this,steps:this.steps,leaps:s.config.leaps,center:t});this.beehives.push(e),n("#script-options").show()},t.prototype.addMapObject=function(t){t.set("map",this.options.gmap)},t.prototype.removeMapObject=function(t){return t.set("map",null),t=null},t.prototype.addListener=function(t,e,i){google.maps.event.addListener(t,e,i)},t.prototype.changeSteps=function(t){this.steps=Number(n("#steps").val()),null!==this.activeBeehive&&this.activeBeehive.resize(this.steps)},t.prototype.removeActiveHive=function(){null!==this.activeBeehive&&(this.activeBeehive.reset(!0),this.beehives.splice(this.beehives.indexOf(this.activeBeehive),1),this.activeBeehive=null,n("#remove").hide(),0===this.beehives().length&&n("#script-options").hide())},t.prototype.setActiveBeehive=function(t){null!==this.activeBeehive&&this.activeBeehive.disableActive(),null!==t?(n("#remove").show(),n("#edit-hives").show()):(n("#remove").hide(),n("#edit-hives").hide()),this.activeBeehive=t},t.prototype.editHives=function(){this.activeBeehive.editHives()},t.prototype.getActiveHives=function(){return p.flatten(p.map(this.beehives(),function(t){return t.activeHives()}))},t}();i.Map=c},{"../config.ts":"/private/var/www/vhosts/pgm-multiloc/src/scripts/config.ts","./beehive.ts":"/private/var/www/vhosts/pgm-multiloc/src/scripts/app/beehive.ts","./viewModel.ts":"/private/var/www/vhosts/pgm-multiloc/src/scripts/app/viewModel.ts",jquery:"jquery",knockout:"knockout",lodash:"lodash"}],"/private/var/www/vhosts/pgm-multiloc/src/scripts/app/viewModel.ts":[function(t,e,i){"use strict";var s=t("../config.ts"),o=t("jquery"),n=t("knockout"),a=t("lodash"),r=function(){function t(t){var e=this;this.options=t,this.activeHives=n.computed(function(){return e.getActiveHives()}),this.rocketmapDirectory=n.observable(""),this.os=n.observable(s.config.os),this.os.subscribe(function(t){e.invalidFields([]),"windows"===e.os()?o("#rocketmap-directory").removeAttr("data-abide-ignore"):o("#rocketmap-directory").attr("data-abide-ignore",""),a.forEach(o("input,select,textarea","#generate-ui"),function(t){return o("#generate-ui").foundation("validateInput",o(t))})}),this.accountsPerHive=n.observable(s.config.workers),this.accountColumns=n.observable(s.config.accountColumns),this.accountColumns.subscribe(function(t){return o("#generate-ui").foundation("validateInput",o("#accounts"))}),this.accounts=n.observable(""),this.windowsTemplates=new c(s.config.windowsTemplates),this.linuxTemplates=new c(s.config.linuxTemplates),this.activeTemplates=n.computed(function(){return e.getActiveTemplates()}),this.generateScriptPreview=n.computed(function(){return e.generateScriptOutput(!0).replace(/\n/g,"<br />")}),this.invalidFields=n.observableArray([]),this.isValid=n.computed(function(){return 0===e.invalidFields().length}),this.isValid.subscribe(function(t){t?o("#download").show():o("#download").hide()}),o(document).on("valid.zf.abide invalid.zf.abide",function(t){return e.handleFormInputValidation(t)}),o(document).on("formvalid.zf.abide forminvalid.zf.abide",function(t){return e.handleFormValidation(t)})}return t.prototype.handleFormInputValidation=function(t){var e=o(t.target).attr("name"),i=this.invalidFields.indexOf(e);"valid"===t.type?i>=0&&this.invalidFields.splice(i,1):i<0&&this.invalidFields.push(e)},t.prototype.handleFormValidation=function(t){"valid"===t.type&&this.invalidFields([])},t.prototype.getActiveHives=function(){return this.options.map.activeHives()},t.prototype.getActiveTemplates=function(){return"windows"===this.os()?this.windowsTemplates:this.linuxTemplates},t.prototype.generateScriptOutput=function(t){void 0===t&&(t=!0);var e=this.activeTemplates(),i=this.activeHives(),s=this.accounts().split("\n");if(i.length<=0)return"";for(var o="\n"+e.setup.value()+"\n"+this.replaceVariables(e.server.value(),{"rocketmap-directory":this.rocketmapDirectory(),location:i[0].getCenter().toString()})+"\n"+e.delay.value()+"\n        ",n="",r=0,p=a.map(this.accountColumns().split(","),function(t){return a.trim(t)}),c=0;c<(t?1:i.length);c++){for(var l=[],u=0;u<this.accountsPerHive();u++){var v={};if(s.length>r)for(var h=a.map(s[r].split(","),function(t){return a.trim(t)}),d=0;d<p.length;d++)v[p[d]]=h[d];r++,l.push(this.replaceVariables(e.auth.value(),v))}n+="\n"+this.replaceVariables(e.worker.value(),{"rocketmap-directory":this.rocketmapDirectory(),index:c+1,location:i[c].getCenter().toString(),steps:i[c].steps,"auth-template":a.join(l," ")})+"\n"+e.delay.value()+"\n            "}return o+n},t.prototype.replaceVariables=function(t,e){return a.forOwn(e,function(e,i){return t=t.replace(new RegExp("{"+i+"}","g"),e)}),t},t.prototype.downloadFile=function(){var t=this.generateScriptOutput(!1);this.downloadScript(t,this.activeTemplates().filename.value())},t.prototype.coordsFile=function(){var t=a.join(a.map(this.activeHives(),function(t){return t.getCenter().toString()}),"\n");this.downloadScript(t,"coords.txt")},t.prototype.downloadScript=function(t,e){var i=new Blob([t],{type:"text/plain"}),s=window.URL.createObjectURL(i),n=o("<a>",{style:"display: none;",download:e,href:s});n.on("click",function(){setTimeout(function(){window.URL.revokeObjectURL(s),n.remove()},50)}),o("#generate-ui").append(n),n[0].dispatchEvent(new MouseEvent("click"))},t}();i.ViewModel=r;var p=function(){function t(t){var e=this;this.defaultValue=t,this.value=n.observable(t),this.isDirty=n.observable(!1),this.value.subscribe(function(t){return e.isDirty(!0)})}return t}();i.Template=p;var c=function(){function t(t){this.setup=new p(t.setup),this.server=new p(t.server),this.worker=new p(t.worker),this.auth=new p(t.auth),this.delay=new p(t.delay),this.filename=new p(t.filename)}return t}();i.Templates=c},{"../config.ts":"/private/var/www/vhosts/pgm-multiloc/src/scripts/config.ts",jquery:"jquery",knockout:"knockout",lodash:"lodash"}],"/private/var/www/vhosts/pgm-multiloc/src/scripts/config.ts":[function(t,e,i){"use strict";var s=function(){function t(){}return t.googleMapsKey="AIzaSyDzl3LF54-nmF2Z8G4AhuiMLw_slLxsYC4",t.latitude=37.09024,t.longitude=-95.712891,t.zoom=5,t.leaps=2,t.steps=6,t.maxSteps=100,t.os="windows",t.workers=8,t.accountColumns="username, password",t.windowsTemplates={setup:"taskkill /IM python.exe /F",server:'Start "Server" /d {rocketmap-directory} /MIN python.exe runserver.py -os -l "{location}"',worker:'Start "Worker{index}" /d {rocketmap-directory} /MIN python.exe runserver.py -ns -l "{location}" -st {steps} {auth-template}',auth:'-u {username} -p "{password}"',delay:"ping 127.0.0.1 -n 6 > null",filename:"launch.bat"},t.linuxTemplates={setup:"#!/usr/bin/env bash",server:"nohup python runserver.py -os -l '{location}' &",worker:"nohup python runserver.py -ns -l '{location}' -st {steps} {auth-template} &",auth:"-u {username} -p '{password}'",delay:"sleep 0.5;",filename:"launch.sh"},t}();i.config=s},{}]},{},["/private/var/www/vhosts/pgm-multiloc/src/scripts/app/app.ts"])("/private/var/www/vhosts/pgm-multiloc/src/scripts/app/app.ts")});
//# sourceMappingURL=app.min.js.map
